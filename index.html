<!DOCTYPE html>
<html lang="en">

<head>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WarTD</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>

<body>
    <button onclick="join()">Join a Friend</button>
    <button onclick="window.location.href = 'battle.html'"> Play a Computer</button>
    <button onclick="create()"> Create a Game</button>
    <style>
        button {
            position: relative;
            z-index: 100;
        }

        .swal2-container {
            z-index: 2000000 !important;
            position: absolute;
            height: 100vh;
        }

        body {
            background: green;
            perspective: 500px;
            overflow: hidden;
        }

        #home {
            position: absolute;
            transform-style: preserve-3d;
            scale: 5 5 5;
            top: 300px;
            translate: 500px -20vh 300px;
        }

        #enemy {
            position: absolute;
            transform-style: preserve-3d;
            scale: 5 5 5;
            top: 300px;
            translate: 500px 0px -1000px;
        }

        progress {
            position: absolute;
            z-index: 10;
            height: 50px;
            width: 40vw;
        }

        #eh {
            position: absolute;
            z-index: 12;
            color: black;
            left: 20vw;
        }

        #yh {
            position: absolute;
            z-index: 12;
            color: black;
            left: 60vw;
        }

        #health {
            left: 40vw;
        }

        #cd {
            position: absolute;
            color: black;
            left: 40vw;
            top: 93vh;
            z-index: 20;
        }

        #cldwn {
            height: 8vh;
            top: 92vh;
            width: 100vw;
        }

        .tower {
            position: absolute;
            transform-style: preserve-3d;
        }

        #tower {
            position: absolute;
            width: 100vw;
            height: 100vh;
        }

        button {
            font-size: 20pt;
        }
    </style>
    <p id="eh">Enemy Health</p>
    <p id="yh">Health</p>
    <progress id="enemyhealth" max="100" value="100"></progress>
    <progress id="health" max="100" value="100"></progress>
    <p id="cd">Cooldown</p>
    <progress id="cldwn" max="10" value="10"></progress>
    <model-viewer id="tower" skybox-image="castle.png" class="tower" src="opposite.glb"></model-viewer>
    <script>
        const socket = io();
        var firemove = 0;
        var wave = false;
        var firemovee = -650;
        var efire;
        var et1;

        socket.on("recieve", (theme) => {
            et1 = theme;
            if (et1 === 'fire') {
                if (t1 === 'water') {
                    tower.src = "opposite.glb";
                    tower.orientation = "0deg 0deg 5deg";
                }
                else {
                    tower.src = "fire.glb"
                    tower.orientation = "0deg 0deg 95deg";
                }
            }
            if (et1 === 'water') {
                if (t1 === 'water') {
                    tower.src = "water.glb";
                    tower.orientation = "0deg 0deg 5deg";
                }
                else {
                    tower.src = "opposite.glb"
                    tower.orientation = "0deg 0deg 185deg";
                }
            }
        })
        var alt = false;
        var dama = 2;
        var tow2;
        var dur = 5000;
        var w;
        var edam = 2;
        var exp = 0;
        var tower = document.getElementById("tower");
        tower.style.position = "absolute";
        tower.style.translate = "0px 0px 0px"
        tower.style.transformStyle = "preserve-3d"
        var e1health = 100;
        var rotx = 0, roty = 0;
        tower.ondrag = (e) => {
            if (fire != undefined) {
                rotx = -e.clientY;
                roty = e.clientX;
            }

        }
        var etow2;
        socket.on("tow2", t => {
            alert("The enemy got a new tower!");
            etow2 = tower.cloneNode(true);
            etow2.setAttribute("skybox-image", "")
            etow2.style.scale = "3 3 3";
            etow2.style.position = "absolute";
            etow2.style.width = "50px";
            etow2.style.height = "500px";
            etow2.style.transformStyle = "preserve-3d"
            if (t === "water") {
                etow2.src = "Water.glb";
            }
            if (t === "fire") {
                etow2.src = "Fire.glb";
            }
            document.body.appendChild(etow2);
        })
        var options = ["fire", "water"];
        var back = false;
        var health = 100;
        var t1 = options[Math.floor(Math.random() * options.length)];
        function game() {
            Array.from(document.querySelectorAll("button")).forEach(but => {
                but.remove();
            })
            alert("Tower one is " + t1 + ".");
            function isCollide(a, b) {
                a = a.getBoundingClientRect();
                b = b.getBoundingClientRect();
                return !(
                    ((a.x + a.width) < b.x) ||
                    (a.x > (b.x + b.width))
                );
            }
            socket.on("alt", () => {
                alt = true;
            })
            socket.on("fire", () => {
                if (et1 === "fire") {
                    if (alt) {
                        efire = new Image(200, 200);
                        efire.src = "water.png";
                        efire.style.position = "absolute"
                        document.body.appendChild(efire);
                        function firem() {
                            if (firemovee < -100 && !wave) {
                                efire.style.rotate = -rotx + "deg " + -roty + "deg";
                                efire.style.translate = "0px 0px " + firemovee + "px";
                                firemovee += 10;
                                requestAnimationFrame(firem);
                            }
                            else {
                                firemovee = -650;
                                efire.remove();
                            }
                        }
                        firem()
                    }
                    else {
                        efire = new Image(200, 200);
                        efire.src = "fire.png";
                        efire.style.position = "absolute"
                        document.body.appendChild(efire);
                        function firem() {

                            if (firemovee < -100 && !wave) {
                                efire.style.rotate = -rotx + "deg " + -roty + "deg";

                                efire.style.translate = "0px 0px " + firemovee + "px";
                                firemovee += 10;
                                requestAnimationFrame(firem);
                            }
                            else {
                                firemovee = -650

                                efire.remove();

                            }
                        }
                        firem();
                    }
                }
                else {
                    if (alt) {
                        efire = new Image(200, 200);
                        efire.src = "fire.png";
                        efire.style.position = "absolute"
                        document.body.appendChild(efire);
                        function firem() {

                            if (firemovee < -100 && !wave) {
                                efire.style.rotate = -rotx + "deg " + -roty + "deg";

                                efire.style.translate = "0px 0px " + firemovee + "px";
                                firemovee += 10;
                                requestAnimationFrame(firem);
                            }
                            else {
                                firemovee = -650

                                efire.remove();

                            }
                        }
                        firem();
                    }
                    else {
                        efire = new Image(200, 200);
                        efire.src = "water.png";
                        efire.style.position = "absolute"
                        document.body.appendChild(efire);
                        function firem() {
                            if (firemovee < -100 && !wave) {
                                efire.style.rotate = -rotx + "deg " + -roty + "deg";

                                efire.style.translate = "0px 0px " + firemovee + "px";
                                firemovee += 10;
                                requestAnimationFrame(firem);
                            }
                            else {
                                firemovee = -650;
                                efire.remove();
                            }
                        }
                        firem()
                    }
                }
            });
            socket.on("def", (d) => {
                if (et1 === "fire") {
                    if (alt) {
                        alert("You got stunned!");
                        wave = true;
                        setTimeout(() => {
                            wave = false
                        }, d)
                    }
                    else {
                        alert("The enemy has activated their firewall!");
                        invincible = true;
                        setTimeout(() => {
                            invincible = false
                        }, d)
                    }
                }
                else {
                    if (alt) {
                        alert("The enemy has activated their firewall!");
                        invincible = true;
                        setTimeout(() => {
                            invincible = false
                        }, d)
                    }
                    else {
                        alert("You got stunned!");
                        wave = true;
                        setTimeout(() => {
                            wave = false
                        }, d)
                    }

                }
            })
            var fire;
            var castle = false;
            function shoot2(tow, dam) {
                if (tow === "fire") {
                    fire = new Image(200, 200);
                    fire.src = "fire.png";
                    fire.style.position = "absolute"
                    document.body.appendChild(fire);
                    function firem() {
                        firemove -= 10;
                        exp += 10;

                        document.onmousemove = (e) => {
                            fire.style.rotate = rotx + "deg " + roty + "deg";

                            fire.style.translate = e.clientX + "px 0px " + firemove + "px";
                        }
                        if (firemove > -650) {
                            requestAnimationFrame(firem);
                        }
                        else {
                            firemove = 0;

                            e1health -= dam;
                            document.getElementById("enemyhealth").value -= dam;
                            if (document.getElementById("enemyhealth").value <= 0) {
                                if (castle) {
                                    alert("You Won!");
                                    socket.emit("over");
                                    document.onkeydown = null;
                                }
                                else {socket.emit("remove");
                                if(t1=== "water"){
                                    tower.src = "Water.glb"
                                }
                                else if(t1=== "fire"){
                                    tower.src = "Fire.glb";
                                }

                                alert("Aim for the castle to finish them off.");
                                castle = true;
                                document.getElementById("enemyhealth").value = 100;

}                            }
                            hits++;
                            socket.emit("damage", dama);
                            if (hits === 10) {
                                hits = 0;
                                upgrade();



                                fire.remove();
                            }
                        }
                    }
                    requestAnimationFrame(firem);
                }
                if (document.activeElement === tow2) {
                    setTimeout(shoot, 10000);
                }
            }
            var cd = 10
            function cooldown() {
                able = false;
                if (cd > 0) {
                    cd--;
                    document.getElementById("cldwn").value = cd;
                    setTimeout(cooldown, 1000);
                }
                else {
                    cd = document.getElementById("cldwn").max;
                    document.getElementById("cldwn").value = cd;
                    able = true;
                }

            }
            var invincible = false;
            function fdef() {

                alert("FireWall Activated, you are invincible for 5 seconds.")
                invincible = true;
                setTimeout(() => {
                    invincible = false
                }, dur);

            }
            var hits = 0;
            function shoot(tow, dam) {
                if (tow2 === undefined) {
                    if (tow === "fire") {
                        fire = new Image(200, 200);
                        fire.src = "fire.png";
                        fire.style.position = "absolute"
                        document.body.appendChild(fire);
                        function firem() {
                            firemove -= 10;
                            exp += 10;
                            if (exp === 10000) {
                                alert("You got a new Tower! Click the tower you want to use currently to control it!");
                                if (t1 === "fire") {
                                    t2 = "water";
                                    tow2 = tower.cloneNode(true);
                                    tow2.setAttribute("skybox-image", "")
                                    tow2.style.scale = "7 7 7";
                                    tow2.style.position = "absolute";
                                    tow2.style.width = "50px";
                                    tow2.style.height = "500px";
                                    socket.emit("tower2", t2);
                                    tow2.style.transformStyle = "preserve-3d"
                                    tow2.src = "Water.glb";
                                    document.body.appendChild(tow2);
                                    if (document.activeElement === tow2) {
                                        var time = 20000;
                                        var timeoff = 10000;
                                        var poison = false;
                                        var able = false;
                                        setTimeout(() => {
                                            able = true;
                                        }, timeoff);
                                        document.onkeydown = (e) => {
                                            if (e.key === "d" && able == true) {
                                                cooldown();
                                                defend(time);
                                                socket.emit("defend", dur);
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                            if (e.key === " " && able == true) {
                                                cooldown();
                                                attack2();
                                                socket.emit("fire")

                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                            if (e.key === "r" && able == true) {
                                                tower.ondrag = (e) => {
                                                    tower.style.left = e.clientX + "px";
                                                }
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                        }
                                    }
                                    else {

                                    }
                                }
                                else if (t1 === "water") {
                                    t2 = "fire";
                                    tow2 = tower.cloneNode(true);
                                    tow2.setAttribute("skybox-image", "")
                                    tow2.style.scale = "7 7 7";
                                    tow2.style.position = "absolute";
                                    tow2.style.width = "50px";
                                    tow2.style.height = "500px";
                                    socket.emit("tower2", t2);
                                    tow2.style.transformStyle = "preserve-3d"
                                    tow2.src = "Fire.glb";
                                    document.body.appendChild(tow2);
                                    if (document.activeElement === tow2) {
                                        var damage = 2;
                                        var timeoff = 10000;
                                        var poison = false;
                                        var able = true;
                                        document.onkeydown = (e) => {
                                            if (e.key === " " && able == true) {
                                                cooldown();
                                                shoot(t1, dama);
                                                socket.emit("fire")
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                            if (e.key === "d" && able == true) {
                                                socket.emit("defend", dur);
                                                cooldown();
                                                fdef();
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                            if (e.key === "r" && able == true) {
                                                cooldown();
                                                tower.ondrag = (e) => {
                                                    tower.style.left = e.clientX;
                                                }
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                        }

                                    }
                                    else {
                                    }
                                }
                            }
                            document.onmousemove = (e) => {
                                fire.style.rotate = rotx + "deg " + roty + "deg";

                                fire.style.translate = e.clientX + "px 0px " + firemove + "px";
                            }
                            if (firemove > -650 && !wave) {
                                requestAnimationFrame(firem);
                            }
                            else {
                                firemove = 0;
                                if (!invincible) {
                                    hits++;
                                    socket.emit("damage", dama);
                                    if (hits === 10) {
                                        hits = 0;
                                        upgrade();
                                    }
                                    e1health -= dam;
                                    document.getElementById("enemyhealth").value -= dam;
                                    if (document.getElementById("enemyhealth").value <= 0) {
                                        if (castle) {
                                                alert("You Won!");
                                            socket.emit("over");
                                            document.onkeydown = null;
                                        }
                                        else {socket.emit("remove");
                                                                            document.getElementById("tower").src= t1 + ".glb"
                                            alert("Aim for the castle to finish them off.");
                                        castle = true;
                                        document.getElementById("enemyhealth").value = 100;
}
                                    }
                                }
                                fire.remove();
                            }
                        }
                        requestAnimationFrame(firem);
                    }
                }
                else {
                    if (tow === "fire") {
                        fire = new Image(200, 200);
                        fire.src = "fire.png";
                        fire.style.position = "absolute"
                        document.body.appendChild(fire);
                        function firem() {
                            firemove -= 10;
                            exp += 10;
                            if (exp === 10000) {
                                exp = 0;
                                alert("You got a new Tower! Click the tower you want to use currently to control it!");
                                if (t1 === "fire") {
                                    t2 = "water";
                                    tow2 = tower.cloneNode(true);
                                    tow2.setAttribute("skybox-image", "")
                                    tow2.style.scale = "7 7 7";
                                    tow2.style.position = "absolute";
                                    tow2.style.width = "50px";
                                    tow2.style.height = "500px";
                                    socket.emit("tower2", t2);
                                    tow2.style.transformStyle = "preserve-3d"
                                    tow2.src = "Water.glb";
                                    document.body.appendChild(tow2);
                                    if (document.activeElement === tow2) {
                                        var time = 20000;
                                        var timeoff = 10000;
                                        var poison = false;
                                        var able = false;
                                        setTimeout(() => {
                                            able = true;
                                        }, timeoff);
                                        document.onkeydown = (e) => {
                                            if (e.key === "d" && able == true) {
                                                cooldown();
                                                defend(time);
                                                socket.emit("defend", dur);
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                            if (e.key === " " && able == true) {
                                                cooldown();
                                                attack2();
                                                socket.emit("fire")

                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                            if (e.key === "r" && able == true) {
                                                tower.ondrag = (e) => {
                                                    tower.style.left = e.clientX + "px";
                                                }
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                        }
                                        setTimeout(shoot, 10000, t1, 2);
                                    }
                                    else {
                                        setTimeout(defend2, 10000, dur)
                                        setTimeout(attack2, 20000)
                                    }
                                }
                                else if (t1 === "water") {
                                    t2 = "fire";
                                    tow2 = tower.cloneNode(true);
                                    tow2.setAttribute("skybox-image", "")
                                    tow2.style.scale = "7 7 7";
                                    tow2.style.position = "absolute";
                                    tow2.style.width = "50px";
                                    tow2.style.height = "500px";
                                    socket.emit("tower2", t2);
                                    tow2.style.transformStyle = "preserve-3d"
                                    tow2.src = "Fire.glb";
                                    document.body.appendChild(tow2);
                                    if (document.activeElement === tow2) {
                                        var damage = 2;
                                        var timeoff = 10000;
                                        var poison = false;
                                        var able = true;
                                        document.onkeydown = (e) => {
                                            if (e.key === " " && able == true) {
                                                cooldown();
                                                shoot(t1, dama);
                                                socket.emit("fire")
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                            if (e.key === "d" && able == true) {
                                                socket.emit("defend", dur);
                                                cooldown();
                                                fdef();
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                            if (e.key === "r" && able == true) {
                                                cooldown();
                                                tower.ondrag = (e) => {
                                                    tower.style.left = e.clientX;
                                                }
                                                setTimeout(() => {
                                                    able = true;
                                                }, timeoff);

                                            }
                                        }
                                        setTimeout(defend2, 10000, dur);
                                        setTimeout(attack2, 20000)
                                    }
                                    else {
                                        setTimeout(shoot2, 10000, t2, damage)
                                    }
                                }
                            }
                            document.onmousemove = (e) => {
                                fire.style.rotate = rotx + "deg " + roty + "deg";
                                fire.style.translate = e.clientX + "px 0px " + firemove + "px";
                            }
                            if (firemove > -650 && !wave) {
                                requestAnimationFrame(firem);
                            }
                            else {
                                firemove = 0;
                                if (!invincible) {
                                    hits++;
                                    socket.emit("damage", dama);
                                    if (hits === 10) {
                                        hits = 0;
                                        upgrade();
                                    }
                                    e1health -= dam;
                                    document.getElementById("enemyhealth").value -= dam;
                                    if (document.getElementById("enemyhealth").value <= 0) {
                                        if (castle) {
                                                alert("You Won!");
                                            socket.emit("over");
                                            document.onkeydown = null;
                                        }
                                        else {socket.emit("remove");
                                        if(t1=== "water"){
                                    tower.src = "Water.glb"
                                }
                                else if(t1=== "fire"){
                                    tower.src = "Fire.glb";
                                }                                            alert("Aim for the castle to finish them off.");
                                        castle = true;
                                        document.getElementById("enemyhealth").value = 100;
}
                                    }
                                }
                                fire.remove();
                            }
                        }
                        requestAnimationFrame(firem);
                    }
                }
            }
            var watermove = 0;
            var wx = 0;
            function attack() {
                if (tow2 === undefined) {
                    fire = new Image(200, 200);
                    fire.src = "water.png";
                    fire.style.position = "absolute"
                    document.body.appendChild(fire);
                    function firem() {
                        watermove -= 10;
                        exp += 10;
                        if (exp === 10000) {
                            exp = 0;
                            alert("You got a new Tower! Click the tower you want to use currently to control it!");
                            if (t1 === "fire") {
                                t2 = "water";
                                tow2 = tower.cloneNode(true);
                                tow2.setAttribute("skybox-image", "")
                                tow2.style.scale = "7 7 7";
                                tow2.style.position = "absolute";
                                tow2.style.width = "50px";
                                tow2.style.height = "500px";
                                socket.emit("tower2", t2);
                                tow2.style.transformStyle = "preserve-3d"
                                tow2.src = "Water.glb";
                                document.body.appendChild(tow2);
                                if (document.activeElement === tow2) {
                                    var time = 20000;
                                    var timeoff = 10000;
                                    var poison = false;
                                    var able = false;
                                    setTimeout(() => {
                                        able = true;
                                    }, timeoff);
                                    document.onkeydown = (e) => {
                                        if (e.key === "d" && able == true) {
                                            cooldown();
                                            defend(time);
                                            socket.emit("defend", dur);


                                        }
                                        if (e.key === " " && able == true) {
                                            cooldown();
                                            attack2();
                                            socket.emit("fire")



                                        }
                                        if (e.key === "r" && able == true) {
                                            tower.ondrag = (e) => {
                                                tower.style.left = e.clientX + "px";
                                            }


                                        }
                                    }
                                }
                                else {
                                }
                            }
                            else if (t1 === "water") {
                                t2 = "fire";
                                tow2 = tower.cloneNode(true);
                                tow2.setAttribute("skybox-image", "")
                                tow2.style.scale = "7 7 7";
                                tow2.style.position = "absolute";
                                tow2.style.width = "50px";
                                tow2.style.height = "500px";
                                socket.emit("tower2", t2);
                                tow2.style.transformStyle = "preserve-3d"
                                tow2.src = "Fire.glb";
                                document.body.appendChild(tow2);
                                if (document.activeElement === tow2) {
                                    var damage = 2;
                                    var timeoff = 10000;
                                    var poison = false;
                                    var able = true;
                                    document.onkeydown = (e) => {
                                        if (e.key === " " && able == true) {
                                            cooldown();
                                            shoot(t1, dama);
                                            socket.emit("fire")


                                        }
                                        if (e.key === "d" && able == true) {
                                            socket.emit("defend", dur);
                                            cooldown();
                                            fdef();


                                        }
                                        if (e.key === "r" && able == true) {
                                            cooldown();
                                            tower.ondrag = (e) => {
                                                tower.style.left = e.clientX;
                                            }


                                        }
                                    }
                                }
                                else {

                                }
                            }
                        }

                        document.onmousemove = (e) => {
                            fire.style.rotate = rotx + "deg " + roty + "deg";

                            fire.style.translate = e.clientX + "px 0px " + watermove + "px";
                        }
                        if (watermove > -650 && !wave) {
                            requestAnimationFrame(firem);
                        }
                        else {
                            watermove = 0;
                            if (!invincible) {
                                e1health -= dama;
                                document.getElementById("enemyhealth").value -= dama;
                                if (document.getElementById("enemyhealth").value <= 0) {
                                    if (castle) {
                                        alert("You Won!");
                                        socket.emit("over");
                                        document.onkeydown = null;
                                    }
                                    else {socket.emit("remove");
                                    if(t1=== "water"){
                                    tower.src = "Water.glb"
                                }
                                else if(t1=== "fire"){
                                    tower.src = "Fire.glb";
                                }                                        alert("Aim for the castle to finish them off.");
                                    castle = true;
                                    document.getElementById("enemyhealth").value = 100;
}
                                }
                                hits++;
                                socket.emit("damage", dama);
                                if (hits === 10) {
                                    hits = 0;
                                    upgrade();
                                }
                            }
                            fire.remove();
                        }
                    }
                    requestAnimationFrame(firem);
                }
                else if (document.activeElement === tower) {
                    fire = new Image(200, 200);
                    fire.src = "water.png";
                    fire.style.position = "absolute"
                    document.body.appendChild(fire);
                    function firem() {
                        watermove -= 10;
                        exp += 10;
                        if (exp === 10000) {
                            exp = 0;
                            alert("You got a new Tower! Click the tower you want to use currently to control it!");
                            if (t1 === "fire") {
                                t2 = "water";
                                tow2 = tower.cloneNode(true);
                                tow2.setAttribute("skybox-image", "")
                                tow2.style.scale = "7 7 7";
                                tow2.style.position = "absolute";
                                tow2.style.width = "50px";
                                tow2.style.height = "500px";
                                socket.emit("tower2", t2);
                                tow2.style.transformStyle = "preserve-3d"
                                tow2.src = "Water.glb";
                                document.body.appendChild(tow2);
                                if (document.activeElement === tow2) {
                                    var time = 20000;
                                    var timeoff = 10000;
                                    var poison = false;
                                    var able = false;
                                    setTimeout(() => {
                                        able = true;
                                    }, timeoff);
                                    document.onkeydown = (e) => {
                                        if (e.key === "d" && able == true) {
                                            cooldown();
                                            defend(time);
                                            socket.emit("defend", dur);


                                        }
                                        if (e.key === " " && able == true) {
                                            cooldown();
                                            attack2();
                                            socket.emit("fire")



                                        }
                                        if (e.key === "r" && able == true) {
                                            tower.ondrag = (e) => {
                                                tower.style.left = e.clientX + "px";
                                            }


                                        }
                                    }
                                    setTimeout(shoot, 10000, t1, 2);
                                }
                                else {
                                }
                            }
                            else if (t1 === "water") {
                                t2 = "fire";
                                tow2 = tower.cloneNode(true);
                                tow2.setAttribute("skybox-image", "")
                                tow2.style.scale = "7 7 7";
                                tow2.style.position = "absolute";
                                tow2.style.width = "50px";
                                tow2.style.height = "500px";
                                socket.emit("tower2", t2);
                                tow2.style.transformStyle = "preserve-3d"
                                tow2.src = "Fire.glb";
                                document.body.appendChild(tow2);
                                if (document.activeElement === tow2) {
                                    var damage = 2;
                                    var timeoff = 10000;
                                    var poison = false;
                                    var able = true;
                                    document.onkeydown = (e) => {
                                        if (e.key === " " && able == true) {
                                            cooldown();
                                            shoot(t1, dama);
                                            socket.emit("fire")


                                        }
                                        if (e.key === "d" && able == true) {
                                            socket.emit("defend", dur);
                                            cooldown();
                                            fdef();


                                        }
                                        if (e.key === "r" && able == true) {
                                            cooldown();
                                            tower.ondrag = (e) => {
                                                tower.style.left = e.clientX;
                                            }


                                        }
                                    }
                                    setTimeout(defend2, 10000, dur);
                                    setTimeout(attack2, 20000)
                                }
                                else {
                                    setTimeout(shoot2, 10000, t2, damage)
                                }
                            }
                        }

                        document.onmousemove = (e) => {
                            fire.style.rotate = rotx + "deg " + roty + "deg";

                            fire.style.translate = e.clientX + "px 0px " + watermove + "px";
                        }
                        if (watermove > -650 && !wave) {
                            requestAnimationFrame(firem);
                        }
                        else {
                            watermove = 0;
                            if (!invincible) {
                                e1health -= dama;
                                document.getElementById("enemyhealth").value -= dama;
                                if (document.getElementById("enemyhealth").value <= 0) {
                                    if (castle) {
                                        alert("You Won!");
                                        socket.emit("over");
                                        document.onkeydown = null;
                                    }
                                    else {socket.emit("remove");
                                    if(t1=== "water"){
                                    tower.src = "Water.glb"
                                }
                                else if(t1=== "fire"){
                                    tower.src = "Fire.glb";
                                }                                        alert("Aim for the castle to finish them off.");
                                    castle = true;
                                    document.getElementById("enemyhealth").value = 100;
}
                                }
                                hits++;
                                socket.emit("damage", dama);
                                if (hits === 10) {
                                    hits = 0;
                                    upgrade();
                                }
                            }
                            fire.remove();
                        }
                    }
                    requestAnimationFrame(firem);
                }
            }
            socket.on("dam", d => {
                if (!invincible) {
                    document.getElementById("health").value -= d;
                }
            })
            function attack2() {
                fire = new Image(200, 200);
                fire.src = "water.png";
                fire.style.position = "absolute"
                document.body.appendChild(fire);
                function firem() {
                    watermove -= 10;
                    document.onmousemove = (e) => {
                        fire.style.rotate = rotx + "deg " + roty + "deg";
                        fire.style.translate = e.clientX + "px 0px " + watermove + "px";
                    }
                    if (watermove > -650 && !wave) {
                        requestAnimationFrame(firem);
                    }
                    else {
                        watermove = 0;
                        if (!invincible) {
                            e1health -= dama;
                            document.getElementById("enemyhealth").value -= dama;
                            if (document.getElementById("enemyhealth").value <= 0) {
                                if (castle) {
                                    alert("You Won!");
                                    socket.emit("over");
                                    document.onkeydown = null;
                                }
                                else {socket.emit("remove");
                                if(t1=== "water"){
                                    tower.src = "Water.glb"
                                }
                                else if(t1=== "fire"){
                                    tower.src = "Fire.glb";
                                }                                alert("Aim for the castle to finish them off.");
                                castle = true;
                                document.getElementById("enemyhealth").value = 100;

}                            }
                            hits++;
                            socket.emit("damage", dama);
                            if (hits === 10) {
                                hits = 0;
                                upgrade();
                            }

                        }
                        if (document.activeElement === tower) {
                            setTimeout(attack2, 20000)
                        }
                        fire.remove();
                    }
                }
                requestAnimationFrame(firem);
            }
            function defend(tim) {
                wave = true;
                alert("Enemy stunned for " + dur / 1000 + " seconds.")
                setTimeout(() => {
                    wave = false;
                }, tim)

            }
            function defend2(tim) {
                wave = true;
                alert("Enemy stunned for " + dur / 1000 + " seconds.")
                setTimeout(() => {
                    wave = false;
                }, tim)
                if (document.activeElement === tower) {
                    setTimeout(defend2, 20000, dur)
                }
            }
            if (t1 === "fire") {
                var damage = 2;
                tower.src = "Fire.glb"
                var timeoff = 10000;
                var poison = false;
                var able = true;
                document.onkeydown = (e) => {
                    if (e.key === " " && able == true) {
                        if (tow2 === undefined || document.activeElement === tower) {
                            cooldown();
                            shoot(t1, dama);
                            socket.emit("fire")
                        }
                        else if (document.activeElement === tow2) {
                            cooldown();
                            attack2();
                            socket.emit("alt")
                            socket.emit("fire")

                        }
                    }
                    if (e.key === "d" && able == true) {
                        if (tow2 === undefined || document.activeElement === tower) {
                            cooldown();
                            socket.emit("defend", dur);
                            fdef();

                        }
                        else if (document.activeElement === tow2) {
                            cooldown();
                            socket.emit("alt")
                            socket.emit("defend", dur);
                            defend();

                        }
                    }
                    if (e.key === "r" && able == true) {
                        cooldown();
                        tower.ondrag = (e) => {
                            tower.style.left = e.clientX;
                        }
                        setTimeout(() => {
                            able = true;
                        }, timeoff);

                    }
                }
            }
            if (t1 === "water") {
                tower.src = "Water.glb"
                var timeoff = 10000;
                var poison = false;
                var able = true;
                setTimeout(() => {
                    able = true;
                }, timeoff);
                document.onkeydown = (e) => {
                    if (e.key === "d" && able == true) {
                        if (tow2 === undefined) {
                            cooldown();
                            defend(dur);
                            socket.emit("defend", dur);

                        }
                        else if (document.activeElement === tower) {
                            cooldown();
                            defend(dur);
                            socket.emit("defend", dur);

                        }
                        else if (document.activeElement === tow2) {
                            cooldown();
                            fdef(dur);
                            socket.emit("alt");
                            socket.emit("defend", dur);

                        }


                    }
                    if (e.key === " " && able == true) {
                        if (tow2 === undefined || document.activeElement === tower) {
                            cooldown();
                            attack();
                            socket.emit("fire")


                        }
                        else if (document.activeElement === tow2) {
                            cooldown();
                            shoot("fire", dama);
                            socket.emit("alt")
                            socket.emit("fire")


                        }
                    }
                    if (e.key === "r" && able == true) {
                        tower.ondrag = (e) => {
                            tower.style.left = e.clientX + "px";
                        }
                        setTimeout(() => {
                            able = true;
                        }, timeoff);

                    }
                }
            }

            async function upgrade() {
                const { value: up } = await Swal.fire({
                    title: "Select Upgrade",
                    input: "radio",
                    inputOptions: { "cooldown": "Cooldown Time", "damage": "Damage Amount", "duration": "Defense Duration" }
                });
                if (up === "cooldown") {

                    if (document.getElementById("cldwn").max > 5) {
                        document.getElementById("cldwn").max = cd;
                        document.getElementById("cldwn").value = cd;
                        cd--;
                    }
                    else {
                        upgrade();
                    }
                }
                else if (up === "damage") {
                    dama++;
                }
                else {
                    dur += 3000;
                }

            }
            socket.on("over", () => {
                alert("Game Over.");
            })
            socket.on("remove", () => {

                if (tow2 != undefined) {
                    tow2.remove();
                    document.getElementById("health").value = 100;
                }
                else {
                    document.onkeydown = null;
                    document.getElementById("health").value = 100;
                    if (et1 === "fire") {
                        document.getElementById("tower").src = "fire.glb";
                    }
                    else if (et1 === "water") {
                        document.getElementById("tower").src = "Water.glb";
                    }
                }
            })
            socket.emit("et1", t1);
        }
    </script>
    <script>

        function join() {
            var roomname = prompt("What is the room?");
            socket.emit("join", roomname);
        }
        function create() {
            var roomname = prompt("Choose a room name.");
            socket.emit("start", roomname);
        }
        socket.on("opengame", game)
        socket.on("success", () => {
            alert("Waiting for another player.");
        })
        socket.on("no", () => {
            alert("room not found.");
        })
        socket.on("taken", () => {
            alert("room name taken, please try again.")
        })

    </script>
</body>

</html>